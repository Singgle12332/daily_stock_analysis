# A股智能分析系统 - 完整配置文档

## 📋 系统概述

本系统是一个基于AI的A股自选股智能分析系统，可以自动分析股票并推送决策仪表盘。系统支持以下功能：

- 📊 **大盘复盘**：每日收盘后自动复盘大盘，包括指数、涨跌统计、板块表现、主力资金流向
- 📈 **个股分析**：分析您的自选股，生成买卖建议和决策仪表盘
- 💰 **主力资金分析**：统计主力资金流入流出情况，展示流入/流出榜前10名
- 🏆 **涨幅趋势榜**：每日涨幅榜和跌幅榜前20名
- 📰 **市场新闻**：自动搜索并汇总市场热点新闻
- 📧 **邮件推送**：自动推送分析结果到您的邮箱

## ⏰ 定时运行时间

### A股交易时间

| 时段 | 时间 | 说明 |
|------|------|------|
| 上午开盘 | 09:30 | 集合竞价结束，开始交易 |
| 上午收盘 | 11:30 | 中午休市 |
| 下午开盘 | 13:00 | 下午交易开始 |
| 下午收盘 | 15:00 | 全天交易结束 |

### 系统定时任务

系统设置为每个交易日 **15:30（北京时间）** 自动运行大盘复盘，即收盘后30分钟。

- **UTC时间**：07:30
- **北京时间**：15:30
- **运行频率**：周一到周五（工作日）

## 🔧 本地配置

### 1. 环境变量配置 (.env)

在项目根目录创建 `.env` 文件，配置以下内容：

```bash
# 自选股列表（逗号分隔，支持沪深两市代码）
STOCK_LIST=300059,600030,600036,601318,300033,688981,002371,688041,002415,603501,300750,002594,300274,300124,601012,600519,000858,000333,600887,600809,300760,600276,603259,600436,300015,600893,000768,600760,600372,600150,002179,000733,600879,688122,600316,002371,688012,688072,688037,688082,600276,688235,002422,688180,688331,00700,03690,09988,01810,00883,00941,00388,01024,02015,02269

# AI 模型配置
GEMINI_API_KEY=sk-AKkkdXloo6qvYRcD5HppTjPcWZUBaQA8rL6ynFdd6MQH64de
GEMINI_MODEL=gemini-3-flash-preview
GEMINI_MODEL_FALLBACK=gemini-2.5-flash
GEMINI_REQUEST_DELAY=3.0

# OpenAI 兼容 API 配置
OPENAI_BASE_URL=https://elysiver.h-e.top
OPENAI_MODEL=Gemini-3-pro-view

# 搜索引擎配置
TAVILY_API_KEYS=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

# 邮件通知配置
EMAIL_SENDER=2839706793@qq.com
EMAIL_PASSWORD=bpvjpchsgyejdggb

# 数据库路径
DATABASE_PATH=./data/stock_analysis.db

# 定时任务配置
SCHEDULE_ENABLED=true
SCHEDULE_TIME=15:30
MARKET_REVIEW_ENABLED=true

# 系统配置
LOG_DIR=./logs
LOG_LEVEL=INFO
MAX_WORKERS=3
DEBUG=false
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 运行方式

```bash
# 完整分析（股票+大盘）
python main.py

# 仅大盘复盘
python main.py --market-review

# 仅股票分析
python main.py --stocks-only

# 分析指定股票
python main.py --stocks 600519

# 不发送通知
python main.py --no-notify
```

## 🚀 GitHub Actions 配置

### 步骤1：进入仓库设置

1. 访问您的Fork仓库：https://github.com/Singgle12332/daily_stock_analysis
2. 点击 `Settings` 标签
3. 左侧菜单选择 `Secrets and variables` → `Actions`
4. 点击 `New repository secret` 添加以下配置

### 步骤2：添加Secrets

#### AI 模型配置（必填）

| Secret 名称 | 值 | 说明 |
|------------|-----|------|
| `GEMINI_API_KEY` | `sk-AKkkdXloo6qvYRcD5HppTjPcWZUBaQA8rL6ynFdd6MQH64de` | Gemini API Key |
| `GEMINI_MODEL` | `gemini-3-flash-preview` | Gemini 模型名称 |
| `GEMINI_MODEL_FALLBACK` | `gemini-2.5-flash` | 备选模型 |
| `GEMINI_REQUEST_DELAY` | `3.0` | 请求延迟（秒）|

#### OpenAI 兼容 API 配置（可选）

| Secret 名称 | 值 | 说明 |
|------------|-----|------|
| `OPENAI_BASE_URL` | `https://elysiver.h-e.top` | API 地址 |
| `OPENAI_MODEL` | `Gemini-3-pro-view` | 模型名称 |

#### 搜索引擎配置（推荐）

| Secret 名称 | 值 | 说明 |
|------------|-----|------|
| `TAVILY_API_KEYS` | `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` | Tavily API Key |

#### 邮件通知配置

| Secret 名称 | 值 | 说明 |
|------------|-----|------|
| `EMAIL_SENDER` | `2839706793@qq.com` | 发件人邮箱 |
| `EMAIL_PASSWORD` | `bpvjpchsgyejdggb` | 邮箱授权码 |

#### 自选股列表配置（必填）

| Secret 名称 | 值 | 说明 |
|------------|-----|------|
| `STOCK_LIST` | 您的49只股票代码 | 自选股代码列表 |

### 步骤3：启用GitHub Actions

1. 点击仓库的 `Actions` 标签
2. 点击 `I understand my workflows, go ahead and enable them`
3. 确认工作流已启用

### 步骤4：手动测试运行

1. 进入 `Actions` → `每日股票分析`
2. 点击 `Run workflow`
3. 选择运行模式：
   - `full` - 完整分析（股票+大盘）
   - `market-only` - 仅大盘复盘
   - `stocks-only` - 仅股票分析
4. 点击 `Run workflow`

### 步骤5：查看运行结果

1. 在 `Actions` 页面查看运行记录
2. 点击具体的运行记录查看日志
3. 查看生成的报告（如果有）

## 📊 大盘复盘报告内容

系统生成的大盘复盘报告包含以下内容：

### 一、市场总结
今日A股市场整体呈现**强势上涨/小幅上涨/小幅下跌/明显下跌**态势。

### 二、主要指数
- **上证指数**: 3200.00 (↑1.50%)
- **深证成指**: 10500.00 (↑1.20%)
- **创业板指**: 2100.00 (↑1.80%)
- **科创50**: 1000.00 (↑2.00%)

### 三、涨跌统计
| 指标 | 数值 |
|------|------|
| 上涨家数 | 3804 |
| 下跌家数 | 1504 |
| 平盘家数 | 151 |
| 涨停 | 248 |
| 跌停 | 4 |
| 两市成交额 | 23324亿 |
| 北向资金 | +50.00亿 |
| 主力净流入 | +120.50亿 |
| 主力流入股票 | 2500家 |
| 主力流出股票 | 2800家 |

### 四、板块表现
- **领涨**: 文化传媒(+5.20%)、互联网服务(+4.80%)、软件开发(+4.50%)
- **领跌**: 石油行业(-2.30%)、采掘行业(-2.10%)、化肥行业(-1.90%)

### 五、主力资金动向
**主力净流入**: +120.50亿元
**主力流入股票**: 2500家
**主力流出股票**: 2800家

**流入榜前5名**:
1. 贵州茅台(+5.20亿)
2. 中国平安(+4.80亿)
3. 招商银行(+4.50亿)
4. 五粮液(+4.20亿)
5. 美的集团(+3.90亿)

**流出榜前5名**:
1. 中国石油(-3.50亿)
2. 中国石化(-3.20亿)
3. 工商银行(-2.80亿)
4. 农业银行(-2.50亿)
5. 中国银行(-2.30亿)

### 六、个股涨幅榜
**涨幅榜前20名：**
1. 文化传媒(+5.20%)
2. 互联网服务(+4.80%)
3. 软件开发(+4.50%)
4. 航天航空(+4.30%)
5. 游戏(+4.10%)
...

**跌幅榜前20名：**
1. 石油行业(-2.30%)
2. 采掘行业(-2.10%)
3. 化肥行业(-1.90%)
4. 煤炭行业(-1.80%)
5. 保险(-1.70%)
...

### 七、市场新闻
[自动搜索并汇总的市场热点新闻]

---
*复盘时间: 15:30*

## 🎯 新增功能说明

### 1. 每日涨幅趋势榜

系统新增了每日涨幅趋势榜功能，展示：
- **涨幅榜前20名**：涨幅最大的20个板块/个股
- **跌幅榜前20名**：跌幅最大的20个板块/个股

帮助您快速了解市场热点和风险点。

### 2. 主力资金流入分析

系统新增了主力资金流入分析功能，包括：
- **主力净流入**：当日主力资金净流入总额
- **流入/流出股票数**：主力资金流入和流出的股票数量
- **流入榜前10名**：主力资金流入最多的10只股票
- **流出榜前10名**：主力资金流出最多的10只股票

帮助您了解主力资金动向，把握市场趋势。

## 🔧 修改定时时间

如需修改定时运行时间，编辑 `.github/workflows/daily_analysis.yml` 文件中的 cron 表达式：

```yaml
schedule:
  - cron: '30 7 * * 1-5'  # UTC 7:30 = 北京时间 15:30
```

常用时间配置：
- 北京时间 09:30（开盘）→ `'30 1 * * 1-5'`
- 北京时间 11:30（午休）→ `'30 3 * * 1-5'`
- 北京时间 13:00（下午开盘）→ `'0 5 * * 1-5'`
- 北京时间 15:00（收盘）→ `'0 7 * * 1-5'`
- 北京时间 15:30（收盘后）→ `'30 7 * * 1-5'`

## 📧 邮件通知配置

### QQ邮箱授权码获取方法

1. 登录QQ邮箱网页版
2. 设置 → 账户 → POP3/SMTP服务
3. 开启服务
4. 点击生成授权码
5. 复制授权码到 `EMAIL_PASSWORD`

### 其他邮箱配置

| 邮箱类型 | SMTP服务器 | 端口 |
|---------|-----------|------|
| QQ邮箱 | smtp.qq.com | 587 |
| 163邮箱 | smtp.163.com | 465 |
| Gmail | smtp.gmail.com | 587 |
| Outlook | smtp-mail.outlook.com | 587 |

## 🐛 常见问题

### Q1: 如何获取邮箱授权码？
A: 以QQ邮箱为例：
1. 登录QQ邮箱网页版
2. 设置 → 账户 → POP3/SMTP服务
3. 开启服务
4. 点击生成授权码
5. 复制授权码到 `EMAIL_PASSWORD`

### Q2: 如何修改定时时间？
A: 编辑 `.github/workflows/daily_analysis.yml` 中的 cron 表达式

### Q3: 如何添加更多通知渠道？
A: 可以同时配置多个Secrets：
- `WECHAT_WEBHOOK_URL` - 企业微信
- `FEISHU_WEBHOOK_URL` - 飞书
- `TELEGRAM_BOT_TOKEN` + `TELEGRAM_CHAT_ID` - Telegram

### Q4: 主力资金数据获取失败怎么办？
A: 系统会自动使用备选数据源，如果仍然失败，该部分数据会显示为0，不影响其他功能。

### Q5: 如何添加更多自选股？
A: 修改 `STOCK_LIST` 环境变量，用逗号分隔多个股票代码。

## 📝 配置完成后的效果

- ✅ 每个交易日15:30自动运行大盘复盘
- ✅ 分析您的所有自选股（49只）
- ✅ 生成决策仪表盘（买卖建议、检查清单）
- ✅ 展示涨幅榜前20名和跌幅榜前20名
- ✅ 分析主力资金流入流出情况
- ✅ 推送分析结果到邮箱
- ✅ 完全免费，使用GitHub Actions运行

## 📞 技术支持

如遇到问题，请检查：
1. 环境变量配置是否正确
2. API Key是否有效
3. 邮箱授权码是否正确
4. GitHub Actions是否已启用
5. 运行日志中的错误信息

---

**配置完成！祝您投资顺利！** 📈
